{% layout none %}
{ "products": [{% assign indx ="" %}{% assign cart_itm = cart.items | map: "product_id" | join:"," %}{% for item in search.results %}{% assign add_ons = item.metafields.my_fields.add_on %}{% if add_ons != blank %}{% assign add_ons = item.metafields.my_fields.add_on | split :"," %}{% for product_id in add_ons %}{% assign product_id =  product_id | strip %}{% unless indx contains product_id %}{% assign product_v2 = all_products[product_id] %}{% unless cart_itm contains product_v2.id %}{{ product_v2 | json }},{% endunless %}{% endunless %}{% assign indx = indx | append:product_id %}{% endfor %}{% endif %}{% endfor %}]}