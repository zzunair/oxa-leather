<section class="quick-view">
  {{ 'template-collection.css' | asset_url | stylesheet_tag }}
  {{ 'component-loading-overlay.css' | asset_url | stylesheet_tag }}
  {{ 'component-card.css' | asset_url | stylesheet_tag }}
  {{ 'component-price.css' | asset_url | stylesheet_tag }}

  <link
    rel="preload"
    href="{{ 'component-rte.css' | asset_url }}"
    as="style"
    onload="this.onload=null;this.rel='stylesheet'"
  >

  <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">

  {%- if section.settings.enable_quick_add -%}
    <link rel="stylesheet" href="{{ 'quick-add.css' | asset_url }}" media="print" onload="this.media='all'">
    <script src="{{ 'quick-add.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'product-form.js' | asset_url }}" defer="defer"></script>
  {%- endif -%}
  <noscript>{{ 'component-rte.css' | asset_url | stylesheet_tag }}</noscript>

  {%- style -%}
      .section-{{ section.id }}-padding {
        padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
        padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
      }

      @media screen and (min-width: 750px) {
        .section-{{ section.id }}-padding {
          padding-top: {{ section.settings.padding_top }}px;
          padding-bottom: {{ section.settings.padding_bottom }}px;
        }
      }
    @media screen and (max-width: 749px) {
        .collection-hero--with-image .collection-hero__inner {
          padding-bottom: calc({{ settings.media_shadow_vertical_offset | at_least: 0 }}px + 2rem);
        }
      }
  {%- endstyle -%}

  {% comment %}theme-check-disable ImgLazyLoading{% endcomment %}
  {{ 'component-collection-hero.css' | asset_url | stylesheet_tag }}

  <div class="section-{{ section.id }}-padding">
    {% comment %} Sort is the first tabbable element when filter type is vertical {% endcomment %}

    <div class="{% if section.settings.filter_type == 'vertical' %} facets-vertical {% endif %}">
      {{ 'component-facets.css' | asset_url | stylesheet_tag }}
      <script src="{{ 'facets.js' | asset_url }}" defer="defer"></script>
      {%- if section.settings.enable_filtering or section.settings.enable_sorting -%}
        <aside
          aria-labelledby="verticalTitle"
          class="facets-wrapper{% unless section.settings.enable_filtering %} facets-wrapper--no-filters{% endunless %}{% if section.settings.filter_type != 'vertical' %} page-width{% endif %}"
          id="main-collection-filters"
          data-id="{{ section.id }}"
        >
          {% render 'facets',
            results: collection,
            enable_filtering: section.settings.enable_filtering,
            enable_sorting: section.settings.enable_sorting,
            filter_type: section.settings.filter_type
          %}
        </aside>
      {%- endif -%}

        <div class="collection-page_filter-facet">
          {%- if section.settings.enable_filtering or section.settings.enable_sorting -%}
            <aside
              aria-labelledby="verticalTitle"
              class="facets-wrapper{% unless section.settings.enable_filtering %} facets-wrapper--no-filters{% endunless %}{% if section.settings.filter_type != 'vertical' %} page-width{% endif %}"
              id="main-collection-filters"
              data-id="{{ section.id }}"
            >
              {% render 'facets',
                results: collection,
                enable_filtering: section.settings.enable_filtering,
                enable_sorting: section.settings.enable_sorting,
                filter_type: section.settings.filter_type
              %}
            </aside>
          {%- endif -%}
          {%- if section.settings.enable_sorting and section.settings.filter_type == 'vertical' -%}
            <facet-filters-form class="facets facets-vertical-sort page-width small-hide no-js-hidden">
              <form class="facets-vertical-form" id="FacetSortForm">
                <div class="facet-filters sorting caption">
                  <div class="facet-filters__field">
                    <div class="facet-filters__label caption-large text-body">
                      <label for="SortBy">{{ 'products.facets.sort_by_label' | t }}</label>
                    </div>
                    <div class="select">
                      {%- assign sort_by = collection.sort_by | default: collection.default_sort_by -%}
                      <select
                        name="sort_by"
                        class="facet-filters__sort select__select caption-large"
                        id="SortBy"
                        aria-describedby="a11y-refresh-page-message"
                      >
                        {%- for option in collection.sort_options -%}
                          <option
                            value="{{ option.value | escape }}"
                            {% if option.value == sort_by %}
                              selected="selected"
                            {% endif %}
                          >
                            {{ option.name | escape }}
                          </option>
                        {%- endfor -%}
                      </select>
                      {% render 'icon-caret' %}
                    </div>
                  </div>
                  <noscript>
                    <button type="submit" class="facets__button-no-js button button--secondary">
                      {{ 'products.facets.sort_button' | t }}
                    </button>
                  </noscript>
                </div>

                <div class="product-count-vertical light" role="status">
                  <div class="product-count__text text-body">
                    <span id="ProductCountDesktop">
                      {%- if collection.results_count -%}
                        {{
                          'templates.search.results_with_count'
                          | t: terms: collection.terms, count: collection.results_count
                        }}
                      {%- elsif collection.products_count == collection.all_products_count -%}
                        {{ 'products.facets.product_count_simple' | t: count: collection.products_count }}
                      {%- else -%}
                        {{
                          'products.facets.product_count'
                          | t: product_count: collection.products_count, count: collection.all_products_count
                        }}
                      {%- endif -%}
                    </span>
                  </div>
                  <div class="loading-overlay__spinner">
                    <svg
                      aria-hidden="true"
                      focusable="false"
                      role="presentation"
                      class="spinner"
                      viewBox="0 0 66 66"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
                    </svg>
                  </div>
                </div>
              </form>
            </facet-filters-form>
          {%- endif -%}
        
          {% render 'new-breadcrumb' %}
          {% if collection.previous_product or collection.next_product or section.settings.product_breadcrumb %}
            <div class="clearfix breadcrumb-collection page-width">
              {% if collection.previous_product or collection.next_product %}
                {% if section.settings.product_narow %}
                  <div class="nav_arrows breadcrumb_text">
                    {% if collection.previous_product %}
                      <a
                        href="{{ collection.previous_product }}"
                        title="{{ 'products.general.previous_product_html' | t }}"
                        class="breadcrumb_link"
                        ><span class="icon-left-arrow"> {{ 'products.general.previous_product_html' | t }}</span></a
                      >
                    {% endif %}
                    {% if collection.previous_product and collection.next_product %}
                      <span class="breadcrumb-divider"> {% render 'next-arrow' %} </span>
                    {% endif %}

                    {% if collection.next_product %}
                      <a
                        href="{{collection.next_product}}"
                        title="{{ 'products.general.next_product_html' | t }}"
                        class="breadcrumb_link"
                      >
                        {{- 'products.general.next_product_html' | t }}
                        <span class="icon-right-arrow"></span
                      ></a>
                    {% endif %}
                  </div>
                {% endif %}
              {% endif %}

              {% if section.settings.product_breadcrumb %}
                <div
                  class="breadcrumb_text"
                  itemscope
                  itemtype="http://schema.org/BreadcrumbList"
                  style="display:none;"
                >
                  <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
                    <a href="{{ shop.url }}" title="{{ shop.name | escape }}" itemprop="item" class="breadcrumb_link">
                      <span itemprop="name">{{ 'general.breadcrumbs.home' | t }}</span>
                    </a>
                    <meta itemprop="position" content="1">
                  </span>
                  <span class="breadcrumb-divider"> {% render 'next-arrow' %} </span>
                  <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
                    {% if collection %}
                      <a
                        href="{{ collection.url }}"
                        title="{{ collection.title | escape }}"
                        itemprop="item"
                        class="breadcrumb_link"
                      >
                        <span itemprop="name">{{ collection.title }}</span>
                        <meta itemprop="position" content="2">
                      </a>
                    {% else %}
                      <a
                        href="/collections/all"
                        title="{{ collections.all.title }}"
                        itemprop="item"
                        class="breadcrumb_link"
                      >
                        <span itemprop="name">{{ collections.all.title }}</span>
                        <meta itemprop="position" content="2">
                      </a>
                    {% endif %}
                  </span>
                  <span class="breadcrumb-divider"> {% render 'next-arrow' %} </span>
                  <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
                    <a href="{{ product.url }}" itemprop="item" class="breadcrumb_link last-child">
                      <span itemprop="name">{{ product.title }}</span>
                      <meta itemprop="position" content="3">
                    </a>
                  </span>
                </div>
              {% endif %}
            </div>
          {% endif %}
        </div>
        {%- paginate collection.products by section.settings.products_per_page -%}
          {%- if collection.products.size == 0 -%}
            <div class="collection collection--empty page-width" id="product-grid" data-id="{{ section.id }}">
              <div class="loading-overlay gradient"></div>
              <div class="title-wrapper center">
                <h2 class="title title--primary">
                  {{ 'sections.collection_template.empty' | t -}}
                  <br>
                  {{
                    'sections.collection_template.use_fewer_filters_html'
                    | t: link: collection.url, class: 'underlined-link link'
                  }}
                </h2>
              </div>
            </div>
          {%- else -%}
            <div class="collection page-width{% if section.settings.filter_type != 'vertical' %} page-width{% endif %}">
              <div class="loading-overlay gradient"></div>
            
              <ul
                id="product-grid"
                data-id="{{ section.id }}"
                class="
                  ts
                  grid product-grid grid--{{ section.settings.columns_mobile }}-col-tablet-down
                  grid--{{ section.settings.columns_desktop }}-col-desktop
                "
              >
            <div class="prohandlequick">
               <h2>{{ section.settings['quick-view'] }}</h2>
            </div>
                {% render 'variable-products-card-product-main-collection-product-grid',
                  collection: collection,
                  forloop: forloop,
                  product: product,
                  section: section,
                  lazy_load: lazy_load
                %}

                {%- for product in collection.products -%}
                  {% assign values = null %}
                  {% if product.options contains 'Color' %}
                    {% assign values = product.variants | map: 'option1' | uniq %}
                  {% endif %}
                  {% if values %}
                    {% for value in values %}
                      {% assign sizes = values.size %}
                    {% endfor %}
                  {% endif %}
                  {% assign lazy_load = false %}
                  {%- if forloop.index > 2 -%}
                    {%- assign lazy_load = true -%}
                  {%- endif -%}
                  {% assign index = forloop.index0 %}
                  {% assign colorlist = '' %}
                  {% assign color = '' %}
                  {% for variant in product.variants %}
                    {% if forloop.index == 1 %}
                      {% if product.metafields.custom.series_title.value != blank %}
                        <div class="prohandle">
                          <span class="series-title">
                            <h2 class="pro">{{- product.metafields.custom.series_title.value -}}</h2>
                          </span>

                          {% comment %}
                            {% if product.metafields.custom.product_modal.value %}
                              <h2>{{ product.metafields.custom.product_modal.value }}</h2>
                            {% else %}
                              <h2 class="pro">{{ product.title }}</h2>
                            {% endif %}
                          {% endcomment %}
                        </div>
                      {% endif %}
                    {% endif %}
                    {% if forloop.index == 3 %}
                      <div class="banner dd {{ forloop.index }}">
                        {% if forloop.index == 3 %}
                          <img src="{{ product.metafields.custom.coll_banner_one | img_url:'master' }}">
                        {% elsif forloop.index == 6 %}
                          <img src="{{ product.metafields.custom.coll_banner_two | img_url:'master' }}">
                        {% endif %}
                      </div>
                    {% endif %}

                    <li
                      size="{{ sizes }}"
                      class="grid__item {% if collection.title contains 'Watch' %}{% if forloop.index > 5  %}display_none{% endif %}{% elsif forloop.index >  5 %}display_none{% endif %}{% if forloop.index > sizes %} display_none {% endif %}"
                      data-active="{{ forloop.index }}"
                    >
                      {% render 'card-product',
                        card_product: product,
                        media_aspect_ratio: section.settings.image_ratio,
                        show_secondary_image: section.settings.show_secondary_image,
                        show_vendor: section.settings.show_vendor,
                        show_rating: section.settings.show_rating,
                        lazy_load: lazy_load,
                        show_quick_add: section.settings.enable_quick_add,
                        section_id: section.id,
                        variant: variant,
                        index: forloop.index0
                      %}
                    </li>
                  {% endfor %}
                {%- endfor -%}
              </ul>

            </div>

            <div class="pagination-wrapper">
              {%- if paginate.next -%}
                <span class="next-page-wrapper">
                  <a href="{{ paginate.next.url }}" id="paginatie-next">Next</a>
                </span>
              {%- endif -%}
              {%- if paginate.previous -%}
                <span>
                  <a href="{{ paginate.previous.url }}" id="paginatie-previous">Previous</a>
                </span>
              {%- endif -%}
            </div>
            {% if collection.products.size > 18 %}
              <div class="collection-load-more loading-overlay__spinner">
                <svg
                  aria-hidden="true"
                  focusable="false"
                  role="presentation"
                  class="spinner"
                  viewBox="0 0 66 66"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30" style="stroke: #000;"></circle>
                </svg>
              </div>
            {% endif %}
          {%- endif -%}
        {%- endpaginate -%}
      </div>
    </div>
  </div>
</section>